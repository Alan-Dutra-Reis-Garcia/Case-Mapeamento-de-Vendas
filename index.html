<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Análise Geográfica de Vendas e Oportunidades — Cartões de Benefícios</title>
<meta name="description" content="Portfólio interativo com análise nacional de vendas e oportunidades para cartões de benefícios, incluindo mapa-múndi estilo Power BI com UFs do Brasil." />

<!-- Leaflet (CDN) -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9q7k="
  crossorigin=""
/>
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-o9N1j7kGStbVQ5ZkS7CcHkGKuX3sI5Gucs5mOH8Z5wY="
  crossorigin=""
></script>

<style>
  :root{
    --bg:#0b1220;
    --panel:#0f172a;
    --muted:#94a3b8;
    --text:#e6edf6;
    --brand:#0ea5e9;        /* azul */
    --brand-2:#10b981;      /* verde */
    --stroke:#1e293b;
  }
  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{
    margin:0;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 80% -10%, rgba(16,185,129,.08), transparent 60%),
      radial-gradient(900px 600px at 10% -10%, rgba(14,165,233,.10), transparent 60%),
      linear-gradient(180deg, #0b1220, #0b1220 60%);
    font-family: Lato, "Open Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    line-height:1.55;
  }
  a{color:var(--brand); text-decoration:none}
  .container{max-width:1200px; margin-inline:auto; padding:24px}

  /* NAV */
  .nav{
    position:sticky; top:0; z-index:50;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg, rgba(11,18,32,.95), rgba(11,18,32,.70));
    border-bottom:1px solid #0f203a;
  }
  .nav .inner{display:flex; align-items:center; justify-content:space-between; gap:16px}
  .brand{display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.2px}
  .brand .dot{
    width:12px; height:12px; border-radius:50%;
    background: radial-gradient(circle at 30% 30%, #67e8f9, #0ea5e9 70%);
    box-shadow:0 0 0 4px rgba(14,165,233,.2), 0 0 18px 2px #0ea5e9;
  }
  .nav ul{display:flex; gap:14px; list-style:none; margin:0; padding:0; flex-wrap:wrap}
  .nav a.link{
    display:inline-block; padding:10px 12px; border-radius:10px; color:var(--text); font-weight:600;
    border:1px solid transparent; transition:.2s ease; opacity:.9
  }
  .nav a.link:hover{border-color:#113455; background:#0c1b32}

  /* HERO */
  .hero{padding:64px 24px 12px}
  .badge{
    display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
    background:linear-gradient(90deg, rgba(14,165,233,.18), rgba(16,185,129,.18));
    border:1px solid #1b3554; color:#bfe5ff; font-weight:700; font-size:12px;
    letter-spacing:.4px; text-transform:uppercase;
  }
  h1{
    font-size: clamp(28px, 4vw, 48px);
    margin:14px 0 8px; line-height:1.12;
    background:linear-gradient(90deg, #e6f6ff, #9be7ff 40%, #a7f3d0 80%);
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .subtitle{color:#cfe7ff; font-size:clamp(14px,1.8vw,18px); opacity:.9}
  .kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-top:28px}
  .kpi{
    background:linear-gradient(180deg,#0b1324,#0a1a32);
    border:1px solid #13304f; border-radius:16px; padding:16px;
    display:flex; flex-direction:column; gap:4px;
  }
  .kpi .label{color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.6px}
  .kpi .value{font-size:26px; font-weight:800}
  .kpi .delta{font-size:12px; font-weight:700}

  /* Sections */
  section{scroll-margin-top:82px; padding:48px 0}
  .section-title{font-size:clamp(20px,2.4vw,28px); margin:0 0 12px}
  .section-sub{color:var(--muted); margin:0 0 24px}
  .panel{
    background:linear-gradient(180deg,#0c1627,#0b1526);
    border:1px solid #13304f; border-radius:18px; padding:18px;
  }

  /* MAP (Leaflet) */
  .map-wrap{display:grid; grid-template-columns: 1.25fr .75fr; gap:18px}
  #map{
    width:100%; height:520px; border-radius:14px; overflow:hidden;
    outline:1px solid #153658;
    box-shadow: inset 0 0 0 1px rgba(21,54,88,.35);
  }
  .legend{
    display:flex; align-items:center; gap:12px; margin-top:12px; flex-wrap:wrap
  }
  .legend .bar{
    width:220px; height:12px; border-radius:999px; border:1px solid #163a5f;
    background: linear-gradient(90deg, #bfe5ff, #0ea5e9);
  }
  .legend small{color:#9cc9ff}
  .side{display:flex; flex-direction:column; gap:10px}
  .side .item{display:flex; justify-content:space-between; gap:12px; border-bottom:1px dashed #163a5f; padding:8px 0}
  .pill{font-size:12px; padding:3px 8px; border-radius:999px; border:1px solid #1b3657; color:#a0e6ff; background:#0b1a33;}

  /* DONUT + INSIGHTS */
  .mix-grid{display:grid; grid-template-columns: 1fr 1fr; gap:18px}
  .donut-card{display:grid; place-items:center; padding:20px}
  .donut-wrap{position:relative; width:min(380px, 100%); aspect-ratio:1/1}
  .donut-wrap svg{width:100%; height:100%}
  .donut-center{position:absolute; inset:0; display:grid; place-items:center; text-align:center; pointer-events:none;}
  .donut-center .big{font-weight:900; font-size:clamp(20px,2.8vw,28px)}
  .legend-list{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
  .lg{display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:10px; background:#0b162a; border:1px solid #16385e; font-size:13px}
  .lg .dot{width:10px; height:10px; border-radius:50%}
  .insights ul{margin:8px 0 0 18px}
  .insights li{margin:6px 0}

  /* CARDS */
  .cards{display:grid; grid-template-columns:repeat(3,1fr); gap:16px}
  .card{
    background:linear-gradient(180deg,#0b1527,#0a1424);
    border:1px solid #133255; border-radius:16px; padding:18px;
    transition: transform .18s ease, box-shadow .18s ease;
  }
  .card:hover{transform:translateY(-4px); box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .card h4{margin:0 0 6px; font-size:18px}
  .card p{margin:0; color:#cfe3fa}

  /* TOOLS */
  .tools{display:flex; gap:10px; flex-wrap:wrap}
  .tool{padding:8px 10px; border:1px solid #153659; background:#0b182e; border-radius:10px; font-weight:700; font-size:13px}

  /* FOOTER */
  footer{padding:26px 24px 48px; color:#a9c8f3}

  /* Responsive */
  @media (max-width: 980px){
    .map-wrap{grid-template-columns:1fr}
    .mix-grid{grid-template-columns:1fr}
    .cards{grid-template-columns:1fr}
    .kpis{grid-template-columns:1fr; gap:10px}
  }

  /* Fade-in */
  .reveal{opacity:0; transform:translateY(14px); transition:opacity .6s ease, transform .6s ease}
  .reveal.visible{opacity:1; transform:translateY(0)}
</style>
</head>
<body>
  <!-- NAV -->
  <header class="nav">
    <div class="container inner">
      <div class="brand"><span class="dot" aria-hidden="true"></span>Cartões de Benefícios • Dashboard</div>
      <nav aria-label="Navegação principal">
        <ul>
          <li><a class="link" href="#resumo">Resumo</a></li>
          <li><a class="link" href="#mapa">Vendas por UF</a></li>
          <li><a class="link" href="#mix">Mix de Clientes</a></li>
          <li><a class="link" href="#oportunidades">Oportunidades</a></li>
          <li><a class="link" href="#tecnologias">Tecnologias</a></li>
          <li><a class="link" href="#conclusao">Conclusão</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section id="resumo" class="hero container">
    <span class="badge">Estudo de Caso • Cobertura Nacional</span>
    <h1>Análise Geográfica de Vendas e Oportunidades de Mercado</h1>
    <p class="subtitle">Um Estudo de Caso para Cartões de Benefícios</p>
    <div class="panel reveal">
      <p style="margin:0">
        <strong>Resumo Executivo:</strong> Atuação nacional com variação relevante entre UFs. Usamos um
        <em>mapa-múndi com basemap satélite</em> e polígonos oficiais do IBGE para visualizar intensidade de vendas,
        identificar lacunas e priorizar campanhas regionais e ofertas multi-produto.
      </p>
    </div>
    <div class="kpis">
      <div class="kpi reveal">
        <span class="label">Receita no Trimestre</span>
        <span class="value" id="kpi-revenue">R$ —</span>
        <span class="delta" id="kpi-growth">—</span>
      </div>
      <div class="kpi reveal">
        <span class="label">UFs Monitoradas</span>
        <span class="value" id="kpi-states">—</span>
        <span class="delta pill">Atuação: Brasil</span>
      </div>
      <div class="kpi reveal">
        <span class="label">Ticket Médio PJ</span>
        <span class="value" id="kpi-ticket">R$ —</span>
        <span class="delta" style="color:#9fe7c7">Meta: +6% no próximo tri</span>
      </div>
    </div>
  </section>

  <!-- MAPA (Leaflet + IBGE) -->
  <section id="mapa" class="container">
    <h2 class="section-title">Vendas por UF (Mapa Interativo — Mapa-Múndi)</h2>
    <p class="section-sub">Basemap satélite (Esri) com polígonos oficiais IBGE. Passe o mouse para ver detalhes.</p>

    <div class="map-wrap">
      <div class="panel reveal" style="padding:0">
        <div id="map" aria-label="Mapa-múndi com UFs do Brasil"></div>
      </div>
      <aside class="panel reveal">
        <div class="legend">
          <span class="pill">Legenda: Vendas (R$ mi)</span>
          <div class="bar" id="legend-bar"></div>
          <small><span id="min-label">mín</span> → <span id="max-label">máx</span></small>
        </div>
        <div class="side" id="side-list" aria-live="polite"></div>
        <p style="color:#9cc9ff; margin-top:8px; font-size:13px">
          Dica: priorize <strong>SP</strong>, <strong>MG</strong> e <strong>RJ</strong> para <em>upsell</em>; acelere aquisição em
          <strong>NE</strong> (BA/PE/CE) e <strong>CO</strong> (GO/DF).
        </p>
      </aside>
    </div>
  </section>

  <!-- MIX -->
  <section id="mix" class="container">
    <h2 class="section-title">Análise de Mix de Clientes</h2>
    <p class="section-sub">Distribuição da base por segmento e implicações de receita.</p>
    <div class="mix-grid">
      <div class="panel donut-card reveal">
        <div class="donut-wrap" aria-label="Gráfico de donut — mix de clientes" role="img">
          <svg viewBox="0 0 120 120">
            <circle cx="60" cy="60" r="44" fill="none" stroke="#0c2543" stroke-width="16"></circle>
            <circle id="seg-peq" cx="60" cy="60" r="44" fill="none" stroke="#0ea5e9" stroke-width="16"
                    stroke-dasharray="0 276.46" transform="rotate(-90 60 60)"></circle>
            <circle id="seg-med" cx="60" cy="60" r="44" fill="none" stroke="#10b981" stroke-width="16"
                    stroke-dasharray="0 276.46" transform="rotate(-90 60 60)"></circle>
            <circle id="seg-grd" cx="60" cy="60" r="44" fill="none" stroke="#93c5fd" stroke-width="16"
                    stroke-dasharray="0 276.46" transform="rotate(-90 60 60)"></circle>
          </svg>
          <div class="donut-center">
            <div>
              <div class="big" id="mix-total">Base</div>
              <div style="color:#9cc9ff; font-weight:700; font-size:13px">Mix de Clientes</div>
            </div>
          </div>
        </div>
        <div class="legend-list" aria-hidden="true">
          <div class="lg"><span class="dot" style="background:#0ea5e9"></span>Pequenas</div>
          <div class="lg"><span class="dot" style="background:#10b981"></span>Médias</div>
          <div class="lg"><span class="dot" style="background:#93c5fd"></span>Grandes</div>
        </div>
      </div>

      <div class="panel insights reveal">
        <h3 style="margin:0 0 8px; font-size:18px">Insights Ação</h3>
        <ul>
          <li><strong>Pequenas Empresas</strong> representam <span id="i-peq">—</span> da <em>base</em>, mas apenas <span id="r-peq">—</span> da <em>receita</em>.
            Oportunidade de elevar ticket médio com bundles (Alimentação + Refeição + Combustível).</li>
          <li><strong>Médias Empresas</strong> com alto potencial de <em>venda cruzada</em> em regiões urbanas (Refeição → Combustível) e gestão de frotas.</li>
          <li><strong>Grandes Corporações</strong> concentram <span id="r-grd">—</span> da receita com <span id="i-grd">—</span> da base: foco em retenção e SLA premium.</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- OPORTUNIDADES -->
  <section id="oportunidades" class="container">
    <h2 class="section-title">Oportunidades de Mercado (Próximas Ações)</h2>
    <p class="section-sub">Cards táticos priorizados para o próximo trimestre.</p>
    <div class="cards">
      <article class="card reveal">
        <h4>1) Expansão Geográfica</h4>
        <p>NE (BA/PE/CE) com densidade crescente de PMEs. Parcerias regionais e onboarding assistido para acelerar adesão.</p>
      </article>
      <article class="card reveal">
        <h4>2) Venda Cruzada</h4>
        <p>Clientes de <strong>Refeição</strong> em centros urbanos com propensão ao cartão de <strong>Combustível</strong>. Combo com gestão de frotas.</p>
      </article>
      <article class="card reveal">
        <h4>3) Ofertas Personalizadas</h4>
        <p>Campanhas com incentivo progressivo e materiais educacionais para RH/colaborador elevarem uso dos benefícios.</p>
      </article>
    </div>
  </section>

  <!-- TECNOLOGIAS -->
  <section id="tecnologias" class="container">
    <h2 class="section-title">Tecnologias e Ferramentas</h2>
    <p class="section-sub">Stack hipotético utilizado na exploração, modelagem e visualização.</p>
    <div class="panel tools reveal">
      <span class="tool">Python</span>
      <span class="tool">Pandas</span>
      <span class="tool">Matplotlib</span>
      <span class="tool">Power BI</span>
      <span class="tool">QGIS</span>
      <span class="tool">JavaScript</span>
      <span class="tool">Leaflet</span>
      <span class="tool">HTML &amp; CSS</span>
    </div>
  </section>

  <!-- CONCLUSÃO -->
  <section id="conclusao" class="container">
    <h2 class="section-title">Conclusão</h2>
    <div class="panel reveal">
      <p style="margin:0">
        A visão nacional por UF evidencia concentração natural no Sudeste e bolsões de crescimento no Nordeste e Centro-Oeste.
        Combinando campanhas regionais, bundles para PMEs e ofertas personalizadas, projetamos avanço orgânico com melhora do ticket
        e da penetração multi-produto. Próximos passos: (1) pilotos AB-test por UF, (2) metas diferenciadas por segmento,
        (3) painel integrado ao CRM/BI para acompanhamento semanal.
      </p>
    </div>
  </section>

  <footer class="container">
    <small>© 2025 — Estudo de Portfólio. Dashboard simulado com dados fictícios. Fonte geográfica: IBGE (malhas GeoJSON).</small>
  </footer>

<script>
/* =========================
   Dados Hipotéticos por UF
   ========================= */
const salesByUF = {
  AC:{nome:"Acre",vendas:20,crescimento:5.8,clientes:1200},
  AL:{nome:"Alagoas",vendas:50,crescimento:6.1,clientes:3100},
  AP:{nome:"Amapá",vendas:18,crescimento:5.2,clientes:1100},
  AM:{nome:"Amazonas",vendas:60,crescimento:5.9,clientes:4200},
  BA:{nome:"Bahia",vendas:130,crescimento:7.2,clientes:10000},
  CE:{nome:"Ceará",vendas:95,crescimento:6.8,clientes:7600},
  DF:{nome:"Distrito Federal",vendas:90,crescimento:7.1,clientes:5200},
  ES:{nome:"Espírito Santo",vendas:70,crescimento:7.3,clientes:5600},
  GO:{nome:"Goiás",vendas:110,crescimento:6.7,clientes:8000},
  MA:{nome:"Maranhão",vendas:65,crescimento:6.0,clientes:5200},
  MT:{nome:"Mato Grosso",vendas:100,crescimento:6.6,clientes:5900},
  MS:{nome:"Mato Grosso do Sul",vendas:95,crescimento:6.4,clientes:5200},
  MG:{nome:"Minas Gerais",vendas:220,crescimento:7.5,clientes:20000},
  PA:{nome:"Pará",vendas:80,crescimento:6.2,clientes:6700},
  PB:{nome:"Paraíba",vendas:55,crescimento:6.0,clientes:3500},
  PR:{nome:"Paraná",vendas:150,crescimento:6.9,clientes:12000},
  PE:{nome:"Pernambuco",vendas:100,crescimento:6.7,clientes:8200},
  PI:{nome:"Piauí",vendas:45,crescimento:5.8,clientes:3000},
  RJ:{nome:"Rio de Janeiro",vendas:160,crescimento:7.0,clientes:15000},
  RN:{nome:"Rio Grande do Norte",vendas:50,crescimento:6.1,clientes:3200},
  RS:{nome:"Rio Grande do Sul",vendas:140,crescimento:6.5,clientes:11000},
  RO:{nome:"Rondônia",vendas:35,crescimento:5.6,clientes:2100},
  RR:{nome:"Roraima",vendas:15,crescimento:5.3,clientes:900},
  SC:{nome:"Santa Catarina",vendas:120,crescimento:6.8,clientes:9000},
  SP:{nome:"São Paulo",vendas:380,crescimento:8.0,clientes:35000},
  SE:{nome:"Sergipe",vendas:40,crescimento:5.9,clientes:2600},
  TO:{nome:"Tocantins",vendas:42,crescimento:6.0,clientes:2800}
};

/* =========================
   Utilitários / Formatação
   ========================= */
function colorScale(value, min, max){
  if(max === min){ return '#0ea5e9'; }
  const t = (value - min) / (max - min);
  const h = 205 - 5*t;      // azul claro → azul forte
  const s = 85 + 10*t;
  const l = 78 - 30*t;
  return `hsl(${h}deg, ${s}%, ${l}%)`;
}
const fmtBR = new Intl.NumberFormat('pt-BR');
const fmtMoeda = new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0});

/* =========================
   KPIs do topo
   ========================= */
(function initKPIs(){
  const values = Object.values(salesByUF);
  const total = values.reduce((s,v)=>s+v.vendas,0);
  const avgGrowth = values.reduce((s,v)=>s+v.crescimento,0)/values.length;
  const totalClients = values.reduce((s,v)=>s+v.clientes,0);
  const ticket = (total*1_000_000)/totalClients;

  document.getElementById('kpi-revenue').textContent = fmtMoeda.format(total * 1_000_000);
  document.getElementById('kpi-growth').textContent = `Crescimento médio: ${avgGrowth.toFixed(1)}%`;
  document.getElementById('kpi-states').textContent = values.length;
  document.getElementById('kpi-ticket').textContent = fmtMoeda.format(ticket);
})();

/* =========================
   Mapa (Leaflet + Esri + IBGE)
   ========================= */
const map = L.map('map', {
  center: [-14.2, -51.9],
  zoom: 4,
  worldCopyJump: true
});

// Basemap tipo satélite (estilo Power BI)
L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { maxZoom: 18, attribution: '© Esri — World Imagery' }
).addTo(map);

// Carregar GeoJSON das UFs via API IBGE (resolução simplificada)
const IBGE_URL = 'https://servicodados.ibge.gov.br/api/v3/malhas/estados?formato=application/vnd.geo+json&resolucao=5';

fetch(IBGE_URL)
  .then(r => r.json())
  .then(geo => {
    // Calcular min/max para a escala
    const vendasVals = Object.keys(salesByUF).map(k=>salesByUF[k].vendas);
    const min = Math.min(...vendasVals);
    const max = Math.max(...vendasVals);

    // Legenda (gradiente)
    document.getElementById('legend-bar').style.background =
      `linear-gradient(90deg, ${colorScale(min,min,max)}, ${colorScale(max,min,max)})`;
    document.getElementById('min-label').textContent = `R$ ${min} mi`;
    document.getElementById('max-label').textContent = `R$ ${max} mi`;

    // Listagem TOP 10 por vendas
    const top = Object.entries(salesByUF)
      .sort((a,b)=>b[1].vendas - a[1].vendas)
      .slice(0,10);
    const side = document.getElementById('side-list');
    side.innerHTML = top.map(([uf,d])=>`
      <div class="item">
        <span>${uf} • ${d.nome}</span>
        <span><strong>${fmtMoeda.format(d.vendas*1_000_000)}</strong>
          <span class="pill" style="margin-left:8px">${d.crescimento.toFixed(1)}%</span></span>
      </div>`).join('');

    // Estilo por UF (choropleth)
    function styleFeature(f){
      const sigla = (f.properties && (f.properties.sigla || f.properties.SIGLA || f.properties.uf || f.properties.UF));
      const d = salesByUF[sigla] || {vendas: min};
      return {
        color: '#0f2744',
        weight: 1.2,
        fillColor: colorScale(d.vendas, min, max),
        fillOpacity: 0.70
      };
    }

    // Interação
    function onEachFeature(feature, layer){
      const sigla = (feature.properties && (feature.properties.sigla || feature.properties.SIGLA || feature.properties.uf || feature.properties.UF));
      const d = salesByUF[sigla];
      const nome = (d && d.nome) || (feature.properties && feature.properties.nome) || 'UF';
      if(d){
        const html = `
          <div><strong>${sigla} — ${nome}</strong></div>
          <div>Vendas no Tri: <strong>${fmtMoeda.format(d.vendas*1_000_000)}</strong></div>
          <div>Crescimento: <strong>${d.crescimento.toFixed(1)}%</strong></div>
          <div>Clientes: <strong>${fmtBR.format(d.clientes)}</strong></div>
        `;
        layer.bindTooltip(html, {sticky:true, direction:'top', opacity:0.95, offset:[0,-2], className:'map-tooltip'});
      }
      layer.on({
        mouseover: (e)=>{
          const l = e.target;
          l.setStyle({weight:2.5, fillOpacity:.9});
          if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) { l.bringToFront(); }
        },
        mouseout: (e)=> geojson.resetStyle(e.target),
        click: (e)=> map.fitBounds(e.target.getBounds(), {maxZoom: 6})
      });
    }

    // Adiciona GeoJSON
    const geojson = L.geoJSON(geo, { style: styleFeature, onEachFeature }).addTo(map);

    // Ajusta o mapa para mostrar o Brasil inteiro, mantendo contexto mundial
    map.fitBounds(geojson.getBounds(), { padding:[20,20] });
  })
  .catch(err=>{
    console.warn('Falha ao carregar malhas do IBGE:', err);
  });

/* =========================
   Donut (SVG) — Mix de Clientes
   ========================= */
(function initDonut(){
  const C = 2 * Math.PI * 44; // circunferência
  const mix = {
    base: { pequenas: 0.58, medias: 0.28, grandes: 0.14 },
    receita: { pequenas: 0.42, medias: 0.36, grandes: 0.22 },
    totalClientes: Object.values(salesByUF).reduce((s,v)=>s+v.clientes,0)
  };
  const segs = [
    { id: 'seg-peq', p: mix.base.pequenas },
    { id: 'seg-med', p: mix.base.medias },
    { id: 'seg-grd', p: mix.base.grandes }
  ];
  let acc = 0;
  segs.forEach(s=>{
    const len = C * s.p;
    const el = document.getElementById(s.id);
    el.setAttribute('stroke-dasharray', `${len.toFixed(2)} ${ (C - len).toFixed(2) }`);
    el.setAttribute('stroke-dashoffset', (-acc).toFixed(2));
    acc += len;
  });
  document.getElementById('mix-total').textContent = `${fmtBR.format(mix.totalClientes)} clientes`;
  document.getElementById('i-peq').textContent = `${(mix.base.pequenas*100).toFixed(0)}%`;
  document.getElementById('i-grd').textContent = `${(mix.base.grandes*100).toFixed(0)}%`;
  document.getElementById('r-peq').textContent = `${(mix.receita.pequenas*100).toFixed(0)}%`;
  document.getElementById('r-grd').textContent = `${(mix.receita.grandes*100).toFixed(0)}%`;
})();

/* =========================
   Fade-in ao rolar
   ========================= */
(function initReveal(){
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(en=>{
      if(en.isIntersecting){ en.target.classList.add('visible'); }
    });
  }, { threshold: .12 });
  document.querySelectorAll('.reveal').forEach(el=> io.observe(el));
})();
</script>

<!-- Estilo leve para o Tooltip do Leaflet (herda do tema) -->
<style>
  .leaflet-tooltip.map-tooltip{
    background:#061126;
    border:1px solid #143153;
    color:#d8eeff;
    border-radius:10px;
    box-shadow:0 10px 24px rgba(0,0,0,.35);
    padding:8px 10px;
  }
  .leaflet-tooltip.map-tooltip:before{ display:none }
</style>
</body>
</html>
