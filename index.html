<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Análise Geográfica de Vendas e Oportunidades — Cartões de Benefícios</title>
<meta name="description" content="Portfólio interativo com análise nacional de vendas e oportunidades para cartões de benefícios, incluindo mapa-múndi estilizado e visualizações." />
<style>
  :root{
    --bg:#0b1220;
    --panel:#0f172a;
    --muted:#94a3b8;
    --text:#e6edf6;
    --brand:#0ea5e9;
    --brand-2:#10b981;
    --accent:#1f2937;
    --card:#0b1324;
    --stroke:#1e293b;
  }
  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{
    margin:0;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 80% -10%, rgba(16,185,129,.08), transparent 60%),
      radial-gradient(900px 600px at 10% -10%, rgba(14,165,233,.10), transparent 60%),
      linear-gradient(180deg, #0b1220, #0b1220 60%);
    font-family: Lato, "Open Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    line-height:1.55;
  }
  a{color:var(--brand); text-decoration:none}
  .container{max-width:1200px; margin-inline:auto; padding:24px}
  /* NAV */
  .nav{
    position:sticky; top:0; z-index:50;
    backdrop-filter:saturate(140%) blur(8px);
    background:linear-gradient(180deg, rgba(11,18,32,.95), rgba(11,18,32,.70));
    border-bottom:1px solid #0f203a;
  }
  .nav .inner{display:flex; align-items:center; justify-content:space-between; gap:16px}
  .brand{
    display:flex; align-items:center; gap:12px; font-weight:800; letter-spacing:.2px
  }
  .brand .dot{
    width:12px; height:12px; border-radius:50%;
    background: radial-gradient(circle at 30% 30%, #67e8f9, #0ea5e9 70%);
    box-shadow:0 0 0 4px rgba(14,165,233,.2), 0 0 18px 2px #0ea5e9;
  }
  .nav ul{display:flex; gap:14px; list-style:none; margin:0; padding:0; flex-wrap:wrap}
  .nav a.link{
    display:inline-block; padding:10px 12px; border-radius:10px; color:var(--text); font-weight:600;
    border:1px solid transparent; transition:.2s ease; opacity:.9
  }
  .nav a.link:hover{border-color:#113455; background:#0c1b32}
  /* HERO */
  .hero{padding:64px 24px 12px}
  .badge{
    display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
    background:linear-gradient(90deg, rgba(14,165,233,.18), rgba(16,185,129,.18));
    border:1px solid #1b3554; color:#bfe5ff; font-weight:700; font-size:12px;
    letter-spacing:.4px; text-transform:uppercase;
  }
  h1{
    font-size: clamp(28px, 4vw, 48px);
    margin:14px 0 8px; line-height:1.12;
    background:linear-gradient(90deg, #e6f6ff, #9be7ff 40%, #a7f3d0 80%);
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .subtitle{color:#cfe7ff; font-size:clamp(14px,1.8vw,18px); opacity:.9}
  .kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-top:28px}
  .kpi{
    background:linear-gradient(180deg,#0b1324,#0a1a32);
    border:1px solid #13304f; border-radius:16px; padding:16px;
    display:flex; flex-direction:column; gap:4px;
  }
  .kpi .label{color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.6px}
  .kpi .value{font-size:26px; font-weight:800}
  .kpi .delta{font-size:12px; font-weight:700}
  /* SECTIONS */
  section{scroll-margin-top:82px; padding:48px 0}
  .section-title{font-size:clamp(20px,2.4vw,28px); margin:0 0 12px; letter-spacing:.2px}
  .section-sub{color:var(--muted); margin:0 0 24px}
  .panel{
    background:linear-gradient(180deg,#0c1627,#0b1526);
    border:1px solid #13304f; border-radius:18px; padding:18px;
  }
  /* MAP */
  .map-wrap{display:grid; grid-template-columns: 1.25fr .75fr; gap:18px}
  .svg-card{position:relative; aspect-ratio: 16/9; border-radius:14px; overflow:hidden; border:1px solid #153658}
  .svg-card svg{width:100%; height:100%; display:block; background:radial-gradient(600px 300px at 70% -10%, rgba(14,165,233,.08), transparent 60%), #08101e}
  .legend{display:flex; align-items:center; gap:12px; margin-top:12px; flex-wrap:wrap}
  .legend .bar{
    width:220px; height:12px; border-radius:999px; border:1px solid #163a5f;
    background: linear-gradient(90deg, #bfe5ff, #0ea5e9);
  }
  .legend small{color:#9cc9ff}
  .tooltip{
    position:absolute; pointer-events:none; z-index:20;
    background:#061126; border:1px solid #143153; color:#d8eeff; font-size:13px;
    padding:10px 12px; border-radius:12px; min-width:220px; box-shadow:0 12px 30px rgba(0,0,0,.35);
    transform:translate(-50%, -110%); opacity:0; transition:opacity .15s ease;
  }
  .tooltip.show{opacity:1}
  .side{display:flex; flex-direction:column; gap:10px}
  .side .item{display:flex; justify-content:space-between; gap:12px; border-bottom:1px dashed #163a5f; padding:8px 0}
  .pill{font-size:12px; padding:3px 8px; border-radius:999px; border:1px solid #1b3657; color:#a0e6ff; background:#0b1a33;}
  /* DONUT + INSIGHTS */
  .mix-grid{display:grid; grid-template-columns: 1fr 1fr; gap:18px}
  .donut-card{display:grid; place-items:center; padding:20px}
  .donut-wrap{position:relative; width:min(380px, 100%); aspect-ratio:1/1}
  .donut-wrap svg{width:100%; height:100%}
  .donut-center{position:absolute; inset:0; display:grid; place-items:center; text-align:center; pointer-events:none;}
  .donut-center .big{font-weight:900; font-size:clamp(20px,2.8vw,28px)}
  .legend-list{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
  .lg{display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:10px; background:#0b162a; border:1px solid #16385e; font-size:13px}
  .lg .dot{width:10px; height:10px; border-radius:50%}
  .insights ul{margin:8px 0 0 18px}
  .insights li{margin:6px 0}
  /* OPPORTUNITIES */
  .cards{display:grid; grid-template-columns:repeat(3,1fr); gap:16px}
  .card{
    background:linear-gradient(180deg,#0b1527,#0a1424);
    border:1px solid #133255; border-radius:16px; padding:18px;
    transition: transform .18s ease, box-shadow .18s ease;
  }
  .card:hover{transform:translateY(-4px); box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .card h4{margin:0 0 6px; font-size:18px}
  .card p{margin:0; color:#cfe3fa}
  /* TOOLS */
  .tools{display:flex; gap:10px; flex-wrap:wrap}
  .tool{padding:8px 10px; border:1px solid #153659; background:#0b182e; border-radius:10px; font-weight:700; font-size:13px}
  /* FOOTER */
  footer{padding:26px 24px 48px; color:#a9c8f3}
  /* RESPONSIVE */
  @media (max-width: 980px){
    .map-wrap{grid-template-columns:1fr}
    .mix-grid{grid-template-columns:1fr}
    .cards{grid-template-columns:1fr}
    .kpis{grid-template-columns:1fr; gap:10px}
  }
  /* FADE-IN on scroll */
  .reveal{opacity:0; transform:translateY(14px); transition:opacity .6s ease, transform .6s ease}
  .reveal.visible{opacity:1; transform:translateY(0)}

  /* D3 map styles */
  .state{ stroke:#0f2744; stroke-width:.8; cursor:pointer; transition:filter .2s ease, opacity .2s ease }
  .state:hover{ filter:brightness(1.15) }
  .state.dim{ opacity:.28 }
  .graticule-path{ fill:none; stroke:#0f2744; stroke-width:1; opacity:.25 }
  .world-land{ fill:#0b1a2f; stroke:#112a47; stroke-width:1 }
</style>
</head>
<body>
  <!-- NAV -->
  <header class="nav">
    <div class="container inner">
      <div class="brand"><span class="dot" aria-hidden="true"></span>Cartões de Benefícios • Dashboard</div>
      <nav aria-label="Navegação principal">
        <ul>
          <li><a class="link" href="#resumo">Resumo</a></li>
          <li><a class="link" href="#mapa">Vendas por Região</a></li>
          <li><a class="link" href="#mix">Mix de Clientes</a></li>
          <li><a class="link" href="#oportunidades">Oportunidades</a></li>
          <li><a class="link" href="#tecnologias">Tecnologias</a></li>
          <li><a class="link" href="#conclusao">Conclusão</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- HERO / RESUMO EXECUTIVO -->
  <section id="resumo" class="hero container">
    <span class="badge">Estudo de Caso • Cobertura Nacional</span>
    <h1>Análise Geográfica de Vendas e Oportunidades de Mercado</h1>
    <p class="subtitle">Um Estudo de Caso para Cartões de Benefícios</p>
    <div class="panel reveal">
      <p style="margin:0">
        <strong>Resumo Executivo:</strong> as vendas no Brasil apresentam assimetria entre regiões. Usamos um
        <em>mapa-múndi realista</em> com foco no Brasil — realçando as cinco regiões — para orientar decisões
        comerciais nacionais. O impacto esperado é a <em>priorização de campanhas por região</em>, <em>upsell</em> por perfil e
        aumento de <em>ticket médio</em> via ofertas direcionadas.
      </p>
    </div>

    <div class="kpis">
      <div class="kpi reveal">
        <span class="label">Receita no Trimestre</span>
        <span class="value" id="kpi-revenue">R$ —</span>
        <span class="delta" id="kpi-growth">—</span>
      </div>
      <div class="kpi reveal">
        <span class="label">Regiões Monitoradas</span>
        <span class="value" id="kpi-states">—</span>
        <span class="delta pill">Atuação: Brasil</span>
      </div>
      <div class="kpi reveal">
        <span class="label">Ticket Médio PJ</span>
        <span class="value" id="kpi-ticket">R$ —</span>
        <span class="delta" style="color:#9fe7c7">Meta: +6% no próximo tri</span>
      </div>
    </div>
  </section>

  <!-- SEÇÃO 1: MAPA -->
  <section id="mapa" class="container">
    <h2 class="section-title">Vendas por Região (Mapa Interativo — Mapa-Múndi)</h2>
    <p class="section-sub">Brasil destacado por <strong>regiões</strong> com dados hipotéticos. Passe o mouse para ver detalhes.</p>

    <div class="map-wrap">
      <div class="svg-card panel reveal" id="map-card" aria-label="Mapa-múndi com Brasil por regiões">
        <!-- Tooltip -->
        <div class="tooltip" id="tooltip" role="dialog" aria-hidden="true"></div>
        <!-- SVG que o D3 vai desenhar -->
        <svg id="worldmap" viewBox="0 0 1000 520" aria-labelledby="mapTitle mapDesc" role="img">
          <title id="mapTitle">Mapa-múndi realista com o Brasil por estados</title>
          <desc id="mapDesc">Mundo em projeção Natural Earth; estados do Brasil com cores por região.</desc>
        </svg>
      </div>

      <aside class="panel reveal">
        <div class="legend">
          <span class="pill">Legenda: Vendas (R$ mi) — Brasil</span>
          <div class="bar" id="legend-bar"></div>
          <small><span id="min-label">mín</span> → <span id="max-label">máx</span></small>
        </div>
        <div class="side" id="side-list" aria-live="polite"></div>
        <p style="color:#9cc9ff; margin-top:8px; font-size:13px">
          Dica: manter <strong>Sudeste</strong> para <em>upsell</em> e reforçar <strong>Nordeste</strong> e <strong>Centro-Oeste</strong> com campanhas de aquisição.
        </p>
      </aside>
    </div>
  </section>

  <!-- SEÇÃO 2: MIX DE CLIENTES -->
  <section id="mix" class="container">
    <h2 class="section-title">Análise de Mix de Clientes</h2>
    <p class="section-sub">Distribuição da base por segmento e implicações de receita.</p>

    <div class="mix-grid">
      <div class="panel donut-card reveal">
        <div class="donut-wrap" aria-label="Gráfico de donut — mix de clientes" role="img">
          <svg viewBox="0 0 120 120">
            <circle cx="60" cy="60" r="44" fill="none" stroke="#0c2543" stroke-width="16"></circle>
            <circle id="seg-peq" cx="60" cy="60" r="44" fill="none" stroke="#0ea5e9" stroke-width="16"
                    stroke-dasharray="0 276.46" transform="rotate(-90 60 60)"></circle>
            <circle id="seg-med" cx="60" cy="60" r="44" fill="none" stroke="#10b981" stroke-width="16"
                    stroke-dasharray="0 276.46" transform="rotate(-90 60 60)"></circle>
            <circle id="seg-grd" cx="60" cy="60" r="44" fill="none" stroke="#93c5fd" stroke-width="16"
                    stroke-dasharray="0 276.46" transform="rotate(-90 60 60)"></circle>
          </svg>
          <div class="donut-center">
            <div>
              <div class="big" id="mix-total">Base</div>
              <div style="color:#9cc9ff; font-weight:700; font-size:13px">Mix de Clientes</div>
            </div>
          </div>
        </div>
        <div class="legend-list" aria-hidden="true">
          <div class="lg"><span class="dot" style="background:#0ea5e9"></span>Pequenas</div>
          <div class="lg"><span class="dot" style="background:#10b981"></span>Médias</div>
          <div class="lg"><span class="dot" style="background:#93c5fd"></span>Grandes</div>
        </div>
      </div>

      <div class="panel insights reveal">
        <h3 style="margin:0 0 8px; font-size:18px">Insights Ação</h3>
        <ul>
          <li><strong>Pequenas Empresas</strong> representam <span id="i-peq">—</span> da <em>base</em>, mas apenas <span id="r-peq">—</span> da <em>receita</em>.
            Oportunidade de elevar ticket médio com bundles (Alimentação + Refeição + Combustível).</li>
          <li><strong>Médias Empresas</strong> com alto potencial de <em>venda cruzada</em> em regiões urbanas (Refeição → Combustível) e gestão de frotas.</li>
          <li><strong>Grandes Corporações</strong> concentram <span id="r-grd">—</span> da receita com <span id="i-grd">—</span> da base: foco em retenção e SLA premium.</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- SEÇÃO 3: OPORTUNIDADES -->
  <section id="oportunidades" class="container">
    <h2 class="section-title">Oportunidades de Mercado (Próximas Ações)</h2>
    <p class="section-sub">Cards táticos priorizados para o próximo trimestre.</p>
    <div class="cards">
      <article class="card reveal">
        <h4>1) Expansão Geográfica</h4>
        <p>Nordeste com densidade crescente de PMEs formais. Parcerias com contabilidades locais e <em>onboarding</em> assistido.</p>
      </article>
      <article class="card reveal">
        <h4>2) Venda Cruzada</h4>
        <p>Clientes de <strong>Refeição</strong> em centros urbanos têm propensão ao cartão de <strong>Combustível</strong>.
          Combo com gestão de frotas e cashback por quilometragem.</p>
      </article>
      <article class="card reveal">
        <h4>3) Ofertas Personalizadas</h4>
        <p>Segmentos com baixo uso do benefício recebem campanhas com incentivo progressivo e materiais de educação para RH e colaboradores.</p>
      </article>
    </div>
  </section>

  <!-- SEÇÃO 4: TECNOLOGIAS -->
  <section id="tecnologias" class="container">
    <h2 class="section-title">Tecnologias e Ferramentas</h2>
    <p class="section-sub">Stack hipotético utilizado na exploração, modelagem e visualização.</p>
    <div class="panel tools reveal">
      <span class="tool">Python</span>
      <span class="tool">Pandas</span>
      <span class="tool">Matplotlib</span>
      <span class="tool">Power BI</span>
      <span class="tool">QGIS</span>
      <span class="tool">JavaScript</span>
      <span class="tool">SVG</span>
      <span class="tool">HTML &amp; CSS</span>
    </div>
  </section>

  <!-- SEÇÃO 5: CONCLUSÃO -->
  <section id="conclusao" class="container">
    <h2 class="section-title">Conclusão</h2>
    <div class="panel reveal">
      <p style="margin:0">
        A leitura nacional mostra concentração natural no Sudeste e bolsões de crescimento no Nordeste e Centro-Oeste.
        Combinando campanhas regionais, bundles para PMEs e ofertas personalizadas, projetamos avanço orgânico com melhora do ticket
        e penetração multi-produto. Próximos passos: (1) pilotos AB-test por região, (2) metas diferenciadas por segmento,
        (3) este painel integrado ao CRM/BI para acompanhamento semanal.
      </p>
    </div>
  </section>

  <footer class="container">
    <small>© 2025 — Estudo de Mapeamento de Vendas. Projeto de portfólio (Planejamento e Desenvolvimento de Negócio).<br>
    Código HTML/CSS/JS único, responsivo e com animações leves. | Autor: Alan Dutra</small>
  </footer>

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>

  <!-- App -->
  <script>
  /* =========================
     Dados Hipotéticos (Nacional)
     ========================= */
  const salesByRegion = {
    N:  { regiao: "Norte",        vendas:  95, crescimento: 6.2, clientes:  9800 },
    NE: { regiao: "Nordeste",     vendas: 160, crescimento: 7.4, clientes: 18200 },
    CO: { regiao: "Centro-Oeste", vendas: 105, crescimento: 6.7, clientes: 11200 },
    SE: { regiao: "Sudeste",      vendas: 340, crescimento: 7.9, clientes: 36500 },
    S:  { regiao: "Sul",          vendas: 155, crescimento: 6.1, clientes: 14900 }
  };
  const mix = {
    base: { pequenas: 0.58, medias: 0.28, grandes: 0.14 },
    receita: { pequenas: 0.42, medias: 0.36, grandes: 0.22 },
    totalClientes: Object.values(salesByRegion).reduce((s,v)=>s+v.clientes,0)
  };

  /* =========================
     Utilitários
     ========================= */
  function colorScale(value, min, max){
    if(max === min){ return '#0ea5e9'; }
    const t = (value - min) / (max - min);
    const h = 205 - 5*t;
    const s = 85 + 10*t;
    const l = 80 - 30*t;
    return `hsl(${h}deg, ${s}%, ${l}%)`;
  }
  const fmtBR = new Intl.NumberFormat('pt-BR');
  const fmtMoeda = new Intl.NumberFormat('pt-BR', { style:'currency', currency:'BRL', maximumFractionDigits:0 });

  /* =========================
     KPIs do topo
     ========================= */
  (function initKPIs(){
    const values = Object.values(salesByRegion);
    const total = values.reduce((s, v) => s + v.vendas, 0);
    const avgGrowth = values.reduce((s, v) => s + v.crescimento, 0) / values.length;
    const totalClients = values.reduce((s, v) => s + v.clientes, 0);
    const ticket = (total * 1_000_000) / totalClients; // R$ por cliente no trimestre

    document.getElementById('kpi-revenue').textContent = fmtMoeda.format(total * 1_000_000);
    document.getElementById('kpi-growth').textContent = `Crescimento médio: ${avgGrowth.toFixed(1)}%`;
    document.getElementById('kpi-states').textContent = values.length;
    document.getElementById('kpi-ticket').textContent = fmtMoeda.format(ticket);
  })();

  /* =========================
     Mapa Realista (D3 + GeoJSON)
     ========================= */
  (async function initMap(){
    const ids = ["N","NE","CO","SE","S"];
    const values = ids.map(id => salesByRegion[id].vendas);
    const min = Math.min(...values);
    const max = Math.max(...values);
    const regionName = { N:"Norte", NE:"Nordeste", CO:"Centro-Oeste", SE:"Sudeste", S:"Sul" };

    // Legenda + lista lateral
    document.getElementById('legend-bar').style.background =
      `linear-gradient(90deg, ${colorScale(min,min,max)}, ${colorScale(max,min,max)})`;
    document.getElementById('min-label').textContent = `R$ ${min} mi`;
    document.getElementById('max-label').textContent = `R$ ${max} mi`;

    const side = document.getElementById('side-list');
    side.innerHTML = ids.map(id=>{
      const d = salesByRegion[id];
      return `<div class="item">
        <span>${d.regiao || regionName[id]}</span>
        <span><strong>${fmtMoeda.format(d.vendas*1_000_000)}</strong>
        <span class="pill" style="margin-left:8px">${d.crescimento.toFixed(1)}%</span></span>
      </div>`;
    }).join('');

    const svg = d3.select("#worldmap");
    const width = 1000, height = 520;
    const g = svg.append("g");

    const WORLD_URL = "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json";
    const BR_STATES_URL = "https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/brazil-states.geojson";

    const worldTopo = await d3.json(WORLD_URL);
    const countries = topojson.feature(worldTopo, worldTopo.objects.countries);

    const projection = d3.geoNaturalEarth1()
      .fitExtent([[8,8],[width-8,height-8]], countries);
    const path = d3.geoPath(projection);

    // Grade e mundo
    const graticule = d3.geoGraticule10();
    g.append("path").datum(graticule).attr("class","graticule-path").attr("d", path);
    g.append("path").datum(countries).attr("class","world-land").attr("d", path);

    // Estados do Brasil
    const stateToRegion = {
      "Rondônia":"N","Acre":"N","Amazonas":"N","Roraima":"N","Pará":"N","Amapá":"N","Tocantins":"N",
      "Maranhão":"NE","Piauí":"NE","Ceará":"NE","Rio Grande do Norte":"NE","Paraíba":"NE","Pernambuco":"NE","Alagoas":"NE","Sergipe":"NE","Bahia":"NE",
      "Mato Grosso":"CO","Mato Grosso do Sul":"CO","Goiás":"CO","Distrito Federal":"CO",
      "Minas Gerais":"SE","Espírito Santo":"SE","Rio de Janeiro":"SE","São Paulo":"SE",
      "Paraná":"S","Santa Catarina":"S","Rio Grande do Sul":"S"
    };

    const brStates = await d3.json(BR_STATES_URL);
    brStates.features.forEach(f => {
      const nm = f.properties.name;
      f.properties.region = stateToRegion[nm] || null;
      f.properties.regionLabel = regionName[f.properties.region] || "—";
    });

    const states = g.selectAll(".state")
      .data(brStates.features)
      .join("path")
      .attr("class","state")
      .attr("d", path)
      .attr("fill", d => {
        const code = d.properties.region;
        if(!code) return "#0b1a2f";
        return colorScale(salesByRegion[code].vendas, min, max);
      })
      .attr("aria-label", d => `Estado: ${d.properties.name} — Região ${d.properties.regionLabel}`);

    // Tooltip por região
    const tooltip = document.getElementById('tooltip');
    function showTip(e, code){
      const d = salesByRegion[code];
      if(!d) return;
      const { clientX:x, clientY:y } = e;
      tooltip.innerHTML = `
        <strong>Região:</strong> ${d.regiao || regionName[code]}<br>
        <strong>Vendas no Tri:</strong> ${fmtMoeda.format(d.vendas*1_000_000)}<br>
        <strong>Crescimento:</strong> ${d.crescimento.toFixed(1)}%<br>
        <strong>Clientes:</strong> ${fmtBR.format(d.clientes)}
      `;
      tooltip.style.left = x + 'px';
      tooltip.style.top = y + 'px';
      tooltip.classList.add('show');
      tooltip.setAttribute('aria-hidden','false');
    }
    function hideTip(){
      tooltip.classList.remove('show');
      tooltip.setAttribute('aria-hidden','true');
    }
    function highlightRegion(code){
      states.classed("dim", s => s.properties.region !== code);
    }
    function clearHighlight(){
      states.classed("dim", false);
    }

    states
      .on("mousemove", (event, d) => {
        const code = d.properties.region;
        if(!code) return;
        highlightRegion(code);
        showTip(event, code);
      })
      .on("mouseleave", () => {
        clearHighlight();
        hideTip();
      })
      .attr("tabindex", 0)
      .on("focus", (event, d) => {
        const code = d.properties.region;
        if(!code) return;
        const rect = event.target.getBoundingClientRect();
        highlightRegion(code);
        showTip({clientX: rect.left + rect.width/2, clientY: rect.top + 20}, code);
      })
      .on("blur", () => {
        clearHighlight();
        hideTip();
      });
  })();

  /* =========================
     Donut (SVG) — Mix de Clientes
     ========================= */
  (function initDonut(){
    const C = 2 * Math.PI * 44;
    const segs = [
      { id: 'seg-peq', p: mix.base.pequenas },
      { id: 'seg-med', p: mix.base.medias },
      { id: 'seg-grd', p: mix.base.grandes }
    ];
    let acc = 0;
    segs.forEach(s=>{
      const len = C * s.p;
      const el = document.getElementById(s.id);
      el.setAttribute('stroke-dasharray', `${len.toFixed(2)} ${(C - len).toFixed(2)}`);
      el.setAttribute('stroke-dashoffset', (-acc).toFixed(2));
      acc += len;
    });
    document.getElementById('mix-total').textContent =
      `${fmtBR.format(mix.totalClientes)} clientes`;
    document.getElementById('i-peq').textContent = `${(mix.base.pequenas*100).toFixed(0)}%`;
    document.getElementById('i-grd').textContent = `${(mix.base.grandes*100).toFixed(0)}%`;
    document.getElementById('r-peq').textContent = `${(mix.receita.pequenas*100).toFixed(0)}%`;
    document.getElementById('r-grd').textContent = `${(mix.receita.grandes*100).toFixed(0)}%`;
  })();

  /* =========================
     Fade-in ao rolar
     ========================= */
  (function initReveal(){
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(en=>{
        if(en.isIntersecting){ en.target.classList.add('visible'); }
      });
    }, { threshold: .12 });
    document.querySelectorAll('.reveal').forEach(el=> io.observe(el));
  })();
  </script>
</body>
</html>
